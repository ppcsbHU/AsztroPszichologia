<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AsztroPszichol√≥gia - Szem√©lyre szabott elemz√©s</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 35%, #112240 65%, #0a1628 100%);
      position: relative;
    }
    
    /* Csillagk√©pek SVG anim√°ci√≥ */
    .constellation-line {
      stroke-dasharray: 100;
      stroke-dashoffset: 100;
      animation: draw-constellation 3s ease-in-out forwards;
    }
    @keyframes draw-constellation {
      to { stroke-dashoffset: 0; }
    }
    
    /* Arany shimmer anim√°ci√≥ - bet≈±nk√©nt */
    .title-shimmer {
      display: inline-block;
    }
    .title-shimmer span {
      display: inline-block;
      background: linear-gradient(135deg, #cd7f32 0%, #daa520 30%, #ffd700 50%, #daa520 70%, #cd7f32 100%);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: letter-shimmer 4s ease-in-out infinite;
    }
    .title-shimmer span:nth-child(1) { animation-delay: 0s; }
    .title-shimmer span:nth-child(2) { animation-delay: 0.1s; }
    .title-shimmer span:nth-child(3) { animation-delay: 0.2s; }
    .title-shimmer span:nth-child(4) { animation-delay: 0.3s; }
    .title-shimmer span:nth-child(5) { animation-delay: 0.4s; }
    .title-shimmer span:nth-child(6) { animation-delay: 0.5s; }
    .title-shimmer span:nth-child(7) { animation-delay: 0.6s; }
    .title-shimmer span:nth-child(8) { animation-delay: 0.7s; }
    .title-shimmer span:nth-child(9) { animation-delay: 0.8s; }
    .title-shimmer span:nth-child(10) { animation-delay: 0.9s; }
    .title-shimmer span:nth-child(11) { animation-delay: 1s; }
    .title-shimmer span:nth-child(12) { animation-delay: 1.1s; }
    .title-shimmer span:nth-child(13) { animation-delay: 1.2s; }
    .title-shimmer span:nth-child(14) { animation-delay: 1.3s; }
    .title-shimmer span:nth-child(15) { animation-delay: 1.4s; }
    .title-shimmer span:nth-child(16) { animation-delay: 1.5s; }
    .title-shimmer span:nth-child(17) { animation-delay: 1.6s; }
    .title-shimmer span:nth-child(18) { animation-delay: 1.7s; }
    @keyframes letter-shimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Csillagok pulz√°l√°sa */
    .star-pulse {
      animation: pulse-star 2s ease-in-out infinite;
    }
    @keyframes pulse-star {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    
    /* Bronz f√©nyhat√°s */
    .bronze-glow {
      box-shadow: 
        0 0 30px rgba(205, 127, 50, 0.3),
        0 0 60px rgba(218, 165, 32, 0.2),
        inset 0 0 20px rgba(205, 127, 50, 0.1);
    }
    
    /* Lebeg≈ë r√©szecsk√©k */
    .particle {
      position: absolute;
      background: radial-gradient(circle, #daa520 0%, transparent 70%);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
      50% { transform: translateY(-20px) translateX(10px); opacity: 0.6; }
    }
    
    /* Hover arany effekt */
    .gold-hover:hover {
      background: linear-gradient(135deg, #cd7f32, #daa520, #ffd700, #daa520, #cd7f32);
      background-size: 200% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gold-flow 2s ease-in-out infinite;
    }
    @keyframes gold-flow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const WORKER_URL = "https://astro-api-proxy.ppcsb87.workers.dev";
    const state = {
      showWelcome: !localStorage.getItem('welcomeShown'),
      birthDate: '',
      birthTime: '',
      birthPlace: '',
      latitude: null,
      longitude: null,
      sunSign: null,
      dailyHoroscope: null,
      fullChart: null,
      selectedAnalysis: '',
      analysisResult: null,
      loading: false,
      error: ''
    };

    if (state.showWelcome) {
      localStorage.setItem('welcomeShown', 'true');
    }

    function updateState(updates) {
      Object.assign(state, updates);
      render();
    }

    function closeWelcome() {
      updateState({ showWelcome: false });
    }

    function getZodiacSign(date) {
      const month = date.getMonth() + 1;
      const day = date.getDate();
      
      if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return { sign: 'Kos', en: 'aries' };
      if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return { sign: 'Bika', en: 'taurus' };
      if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return { sign: 'Ikrek', en: 'gemini' };
      if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return { sign: 'R√°k', en: 'cancer' };
      if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return { sign: 'Oroszl√°n', en: 'leo' };
      if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return { sign: 'Sz≈±z', en: 'virgo' };
      if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return { sign: 'M√©rleg', en: 'libra' };
      if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) return { sign: 'Skorpi√≥', en: 'scorpio' };
      if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) return { sign: 'Nyilas', en: 'sagittarius' };
      if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return { sign: 'Bak', en: 'capricorn' };
      if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return { sign: 'V√≠z√∂nt≈ë', en: 'aquarius' };
      return { sign: 'Halak', en: 'pisces' };
    }

    async function fetchDailyHoroscope(sign) {
      try {
        // Cache key: jegy + mai d√°tum
        const today = new Date().toDateString();
        const cacheKey = `horoscope_${sign}_${today}`;
        
        // Ellen≈ërizz√ºk a cache-t
        const cached = sessionStorage.getItem(cacheKey);
        if (cached) {
          return JSON.parse(cached);
        }
        
        const response = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type: 'aztro', sign: sign })
        });
        
        const data = await response.json();
        
        // Ha Aztro API nem el√©rhet≈ë, haszn√°ljunk fallback-et
        let horoscope;
        if (data.fallback || data.error) {
          // Seed alap√∫ "random" - ugyanaz lesz minden nap ugyanarra a jegyre
          const seed = sign.charCodeAt(0) + new Date().getDate() + new Date().getMonth();
          const luckyNum = (seed * 7 + 13) % 100;
          const colors = ['Arany', 'K√©k', 'Z√∂ld', 'Lila', 'Piros'];
          const colorIndex = seed % colors.length;
          
          horoscope = {
            description: `Mai horoszk√≥pod: A mai nap energikus √©s produkt√≠v lehet sz√°modra. Figyelj az intu√≠ci√≥dra √©s l√©gy nyitott az √∫j lehet≈ës√©gekre. A ${colors[colorIndex].toLowerCase()} sz√≠n hozhat szerencs√©t.`,
            lucky_number: luckyNum,
            color: colors[colorIndex]
          };
        } else {
          horoscope = data;
        }
        
        // Ment√©s cache-be
        sessionStorage.setItem(cacheKey, JSON.stringify(horoscope));
        
        return horoscope;
      } catch (err) {
        console.error('Horoszk√≥p hiba:', err);
        // Fallback horoszk√≥p
        return {
          description: 'A mai nap tele van lehet≈ës√©gekkel. Maradj nyitott √©s pozit√≠v!',
          lucky_number: 7,
          color: 'Arany'
        };
      }
    }

    async function geocodePlace(place) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(place)}&format=json&limit=1`);
        const data = await response.json();
        if (data && data[0]) {
          return {
            lat: parseFloat(data[0].lat),
            lon: parseFloat(data[0].lon)
          };
        }
      } catch (err) {
        console.error('Geocoding hiba:', err);
      }
      return null;
    }

    function calculateAstrologyChart(birthDate, birthTime, lat, lon) {
      try {
        const dateTimeStr = `${birthDate}T${birthTime}:00`;
        const date = new Date(dateTimeStr);
        
        const observer = new Astronomy.Observer(lat, lon, 0);
        
        const sun = Astronomy.SunPosition(date);
        const moon = Astronomy.MoonPosition(date);
        
        return {
          date: date,
          sun: sun,
          moon: moon
        };
      } catch (err) {
        console.error('Chart sz√°m√≠t√°s hiba:', err);
        return null;
      }
    }

    async function handleSubmit(e) {
      e.preventDefault();
      updateState({ loading: true, error: '', dailyHoroscope: null, fullChart: null });

      try {
        if (!state.birthDate) {
          throw new Error('K√©rlek add meg a sz√ºlet√©si d√°tumod!');
        }

        const date = new Date(state.birthDate.replace(/\./g, '-'));
        const zodiac = getZodiacSign(date);
        updateState({ sunSign: zodiac.sign });

        const horoscope = await fetchDailyHoroscope(zodiac.en);

        if (state.birthPlace && state.birthTime) {
          const coords = await geocodePlace(state.birthPlace);
          if (coords) {
            updateState({ latitude: coords.lat, longitude: coords.lon });
            const chart = calculateAstrologyChart(state.birthDate.replace(/\./g, '-'), state.birthTime, coords.lat, coords.lon);
            updateState({ fullChart: chart, dailyHoroscope: horoscope, loading: false });
          } else {
            updateState({ dailyHoroscope: horoscope, loading: false, error: 'Nem siker√ºlt megtal√°lni a helyet. Pr√≥b√°ld meg pontosabban!' });
          }
        } else {
          updateState({ dailyHoroscope: horoscope, loading: false });
        }
      } catch (err) {
        updateState({ error: err.message, loading: false });
      }
    }

    async function generateAnalysis() {
      if (!state.selectedAnalysis) {
        updateState({ error: 'V√°lassz egy elemz√©s t√≠pust!' });
        return;
      }

      updateState({ loading: true, error: '', analysisResult: null });

      try {
        let prompt = '';
        
        const analysisTypes = {
          chart: 'K√©sz√≠ts r√©szletes sz√ºlet√©si chart elemz√©st magyarul.',
          houses: 'K√©sz√≠ts h√°zrendszer elemz√©st magyarul.',
          aspects: 'K√©sz√≠ts aspektus elemz√©st magyarul.',
          transits: 'K√©sz√≠ts mai tranzit elemz√©st magyarul.',
          personality: 'K√©sz√≠ts szem√©lyis√©g m√©lyelemz√©st magyarul.',
          full: 'K√©sz√≠ts teljes asztrol√≥giai √©s pszichol√≥giai jelent√©st magyarul.'
        };

        prompt = `${analysisTypes[state.selectedAnalysis]}
Sz√ºlet√©si adatok: ${state.birthDate}, ${state.birthTime || 'nincs pontos id≈ë'}, ${state.birthPlace || 'nincs hely'}
Napjegy: ${state.sunSign}
${state.selectedAnalysis === 'transits' ? `Mai d√°tum: ${new Date().toLocaleDateString('hu-HU')}` : ''}

Adj r√©szletes pszichol√≥giai elemz√©st √©s praktikus tan√°csokat.

V√ÅLASZOLJ CSAK JSON-BEN:
{"analysis": "r√©szletes elemz√©s sz√∂vege..."}`;

        const response = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: prompt })
        });

        if (!response.ok) throw new Error('API hiba');

        const data = await response.json();
        let cleanText = data.text.replace(/```json|```/g, '').trim();
        
        const firstBrace = cleanText.indexOf('{');
        if (firstBrace > 0) cleanText = cleanText.substring(firstBrace);
        
        const parsed = JSON.parse(cleanText);
        updateState({ analysisResult: parsed.analysis, loading: false });
      } catch (err) {
        updateState({ error: 'Hiba az elemz√©s sor√°n: ' + err.message, loading: false });
      }
    }

    function render() {
      const app = document.getElementById('app');
      app.innerHTML = `
        ${state.showWelcome ? renderWelcomePopup() : ''}
        
        <div class="min-h-screen relative overflow-hidden">
          <!-- Anim√°lt csillagk√©pek -->
          <svg class="absolute inset-0 w-full h-full opacity-25" xmlns="http://www.w3.org/2000/svg">
            <line class="constellation-line" x1="15%" y1="20%" x2="20%" y2="25%" stroke="#cd7f32" stroke-width="1.5"/>
            <line class="constellation-line" x1="20%" y1="25%" x2="25%" y2="22%" stroke="#cd7f32" stroke-width="1.5" style="animation-delay: 0.3s;"/>
            <line class="constellation-line" x1="25%" y1="22%" x2="22%" y2="18%" stroke="#cd7f32" stroke-width="1.5" style="animation-delay: 0.6s;"/>
            <circle cx="15%" cy="20%" r="2.5" fill="#daa520" class="star-pulse"/>
            <circle cx="20%" cy="25%" r="3" fill="#ffd700" class="star-pulse" style="animation-delay: 0.5s;"/>
            <circle cx="25%" cy="22%" r="2.5" fill="#daa520" class="star-pulse" style="animation-delay: 1s;"/>
            <circle cx="22%" cy="18%" r="2" fill="#cd7f32" class="star-pulse" style="animation-delay: 1.5s;"/>
            <line class="constellation-line" x1="75%" y1="30%" x2="80%" y2="35%" stroke="#cd7f32" stroke-width="1.5" style="animation-delay: 1s;"/>
            <line class="constellation-line" x1="80%" y1="35%" x2="85%" y2="32%" stroke="#cd7f32" stroke-width="1.5" style="animation-delay: 1.3s;"/>
            <circle cx="75%" cy="30%" r="2.5" fill="#daa520" class="star-pulse" style="animation-delay: 2s;"/>
            <circle cx="80%" cy="35%" r="3" fill="#ffd700" class="star-pulse" style="animation-delay: 2.5s;"/>
            <circle cx="85%" cy="32%" r="2.5" fill="#cd7f32" class="star-pulse" style="animation-delay: 3s;"/>
          </svg>
          
          <!-- Lebeg≈ë r√©szecsk√©k -->
          <div class="particle" style="top: 10%; left: 30%; width: 4px; height: 4px;"></div>
          <div class="particle" style="top: 40%; left: 70%; width: 3px; height: 3px; animation-delay: 2s;"></div>
          <div class="particle" style="top: 70%; left: 20%; width: 5px; height: 5px; animation-delay: 4s;"></div>
          <div class="particle" style="top: 85%; left: 80%; width: 3px; height: 3px; animation-delay: 1s;"></div>
          
          <div class="relative z-10 container mx-auto px-4 py-12">
            <div class="text-center mb-12">
              <div class="inline-block relative">
                <div class="absolute inset-0 bg-gradient-to-r from-amber-700 to-yellow-600 blur-3xl opacity-20"></div>
                <h1 class="text-7xl font-serif font-bold mb-3 relative drop-shadow-2xl title-shimmer">
                  <span>A</span><span>s</span><span>z</span><span>t</span><span>r</span><span>o</span><span>P</span><span>s</span><span>z</span><span>i</span><span>c</span><span>h</span><span>o</span><span>l</span><span>√≥</span><span>g</span><span>i</span><span>a</span>
                </h1>
                <div class="h-1 bg-gradient-to-r from-transparent via-amber-600 to-transparent relative"></div>
              </div>
              <p class="text-amber-400/90 text-xl mt-5 font-serif italic tracking-wide">
                ≈êsi b√∂lcsess√©g ‚Ä¢ Kozmikus f√©ny ‚Ä¢ Modern elemz√©s
              </p>
            </div>

            <div class="max-w-4xl mx-auto space-y-8">
              ${renderForm()}
              ${state.dailyHoroscope ? renderBasicAnalysis() : ''}
              ${state.fullChart ? renderDetailedOptions() : ''}
              ${state.analysisResult ? renderAnalysisResult() : ''}
            </div>
          </div>
        </div>
      `;

      attachEventListeners();
    }

    function renderWelcomePopup() {
      return `
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
          <div class="bg-gradient-to-br from-slate-900 to-indigo-950 rounded-2xl max-w-2xl w-full p-8 border-2 bronze-glow relative" style="border-color: rgba(205, 127, 50, 0.6);">
            <div class="absolute top-0 left-0 w-16 h-16 border-l-2 border-t-2 rounded-tl-2xl" style="border-color: #daa520;"></div>
            <div class="absolute top-0 right-0 w-16 h-16 border-r-2 border-t-2 rounded-tr-2xl" style="border-color: #daa520;"></div>
            <div class="absolute bottom-0 left-0 w-16 h-16 border-l-2 border-b-2 rounded-bl-2xl" style="border-color: #daa520;"></div>
            <div class="absolute bottom-0 right-0 w-16 h-16 border-r-2 border-b-2 rounded-br-2xl" style="border-color: #daa520;"></div>
            
            <h2 class="text-3xl font-bold text-amber-300 mb-4 font-serif">‚ú® √údv√∂zl√ºnk az AsztroPszichol√≥gia oldalon!</h2>
            <div class="text-amber-100/90 space-y-4 mb-6">
              <p><strong class="text-amber-300">Mit csin√°l ez az oldal?</strong></p>
              <p>Az AsztroPszichol√≥gia egy innovat√≠v alkalmaz√°s, amely √∂tv√∂zi a hagyom√°nyos asztrol√≥gi√°t a modern mesters√©ges intelligencia alap√∫ pszichol√≥giai elemz√©ssel.</p>
              
              <p><strong class="text-amber-300">Hogyan m≈±k√∂dik?</strong></p>
              <ul class="list-disc list-inside space-y-2">
                <li>Megadod a sz√ºlet√©si d√°tumod ‚Üí napi horoszk√≥pot kapsz</li>
                <li>Ha megadod a pontos id≈ët √©s helyet ‚Üí r√©szletes szem√©lyre szabott elemz√©st k√©sz√≠t√ºnk</li>
                <li>AI alap√∫ pszichol√≥giai tan√°csad√°st ny√∫jtunk az asztrol√≥giai adataid alapj√°n</li>
              </ul>

              <div class="bg-green-900/40 border rounded-lg p-4 mt-4" style="border-color: rgba(34, 197, 94, 0.4);">
                <p class="font-semibold text-green-300">üîí Adatv√©delem (GDPR)</p>
                <p class="text-green-200 text-sm mt-2">
                  Ez az oldal <strong>NEM r√∂gz√≠t, NEM t√°rol √©s NEM k√ºld semmilyen szem√©lyes adatot harmadik f√©lnek</strong>. 
                  Minden sz√°m√≠t√°s a b√∂ng√©sz≈ëdben t√∂rt√©nik, az adataid kiz√°r√≥lag az elemz√©s k√©sz√≠t√©s√©hez haszn√°l√≥dnak, 
                  majd azonnal t√∂rl≈ëdnek. Teljes anonimit√°st garant√°lunk!
                </p>
              </div>
            </div>
            <button onclick="window.closeWelcome()" class="w-full py-4 rounded-xl font-bold text-lg transition-all shadow-2xl text-slate-900" style="background: linear-gradient(135deg, #cd7f32, #daa520, #ffd700, #daa520, #cd7f32);">
              √ârtem, folytassuk! üöÄ
            </button>
          </div>
        </div>
      `;
    }

    function renderForm() {
      return `
        <div class="bg-gradient-to-br from-slate-900/70 to-blue-950/60 backdrop-blur-2xl rounded-2xl p-8 border-2 bronze-glow" style="border-color: rgba(205, 127, 50, 0.6);">
          <h2 class="text-2xl font-semibold text-amber-200 mb-6 font-serif">Szem√©lyes Adatok</h2>
          <form id="astroForm" class="space-y-6">
            <div>
              <label class="block text-amber-300/90 mb-2 font-medium">Sz√ºlet√©si D√°tum (√©v.h√≥nap.nap) *</label>
              <input 
                type="text" 
                id="birthDate"
                value="${state.birthDate}"
                placeholder="pl. 1990.05.15"
                pattern="\\d{4}\\.\\d{2}\\.\\d{2}"
                class="w-full px-4 py-3 rounded-lg bg-slate-900/60 border text-amber-100 placeholder-amber-400/50 focus:outline-none focus:ring-2 focus:ring-amber-500"
                style="border-color: rgba(205, 127, 50, 0.4);"
                required
              />
            </div>
            
            <div>
              <label class="block text-amber-300/90 mb-2 font-medium">
                Sz√ºlet√©si Id≈ë (24 √≥r√°s) 
                <span class="text-amber-400/70 text-sm ml-2">(opcion√°lis - r√©szletes elemz√©shez)</span>
              </label>
              <input 
                type="text" 
                id="birthTime"
                value="${state.birthTime}"
                placeholder="pl. 14:30"
                pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]"
                class="w-full px-4 py-3 rounded-lg bg-slate-900/60 border text-amber-100 placeholder-amber-400/50 focus:outline-none focus:ring-2 focus:ring-amber-500"
                style="border-color: rgba(205, 127, 50, 0.4);"
              />
            </div>
            
            <div>
              <label class="block text-amber-300/90 mb-2 font-medium">
                Sz√ºlet√©si Hely 
                <span class="text-amber-400/70 text-sm ml-2">(opcion√°lis - r√©szletes elemz√©shez)</span>
              </label>
              <input 
                type="text" 
                id="birthPlace"
                value="${state.birthPlace}"
                placeholder="pl. Budapest, Magyarorsz√°g"
                class="w-full px-4 py-3 rounded-lg bg-slate-900/60 border text-amber-100 placeholder-amber-400/50 focus:outline-none focus:ring-2 focus:ring-amber-500"
                style="border-color: rgba(205, 127, 50, 0.4);"
              />
            </div>

            <button
              type="submit"
              ${state.loading ? 'disabled' : ''}
              class="w-full py-4 rounded-xl font-bold text-lg transition-all shadow-2xl hover:shadow-amber-500/50 text-slate-900 disabled:opacity-50"
              style="background: linear-gradient(135deg, #cd7f32, #daa520, #ffd700, #daa520, #cd7f32);"
            >
              ${state.loading ? '‚è≥ Elemz√©s folyamatban...' : '‚ú® Alapjellemz√©s K√©sz√≠t√©se'}
            </button>
          </form>

          ${state.error ? `<div class="mt-6 bg-red-900/40 border border-red-600/50 rounded-lg p-4 text-red-200">‚ö†Ô∏è ${state.error}</div>` : ''}
        </div>
      `;
    }

    function renderBasicAnalysis() {
      return `
        <div class="bg-gradient-to-br from-slate-900/70 to-blue-950/60 backdrop-blur-2xl rounded-2xl p-8 border-2 bronze-glow" style="border-color: rgba(205, 127, 50, 0.6);">
          <h2 class="text-2xl font-semibold text-amber-200 mb-4 font-serif">Napi Horoszk√≥pod - ${state.sunSign}</h2>
          
          ${state.dailyHoroscope ? `
            <div class="space-y-4 text-amber-100/90">
              <p class="text-lg leading-relaxed">${state.dailyHoroscope.description}</p>
              
              <div class="grid grid-cols-2 gap-4 mt-6">
                <div class="bg-slate-900/60 border rounded-lg p-4" style="border-color: rgba(205, 127, 50, 0.4);">
                  <div class="text-amber-400 text-sm mb-1">Szerencsesz√°m</div>
                  <div class="text-amber-200 text-2xl font-bold">${state.dailyHoroscope.lucky_number}</div>
                </div>
                <div class="bg-slate-900/60 border rounded-lg p-4" style="border-color: rgba(205, 127, 50, 0.4);">
                  <div class="text-amber-400 text-sm mb-1">Szerencsesz√≠n</div>
                  <div class="text-amber-200 text-2xl font-bold">${state.dailyHoroscope.color}</div>
                </div>
              </div>
            </div>
          ` : ''}

          ${!state.fullChart ? `
            <div class="mt-6 bg-yellow-900/30 border rounded-lg p-4" style="border-color: rgba(234, 179, 8, 0.4);">
              <div class="flex items-start gap-3">
                <div class="text-2xl">üí°</div>
                <div>
                  <h4 class="text-amber-300 font-semibold mb-2">Szeretn√©l r√©szletesebb elemz√©st?</h4>
                  <p class="text-amber-200/80 text-sm mb-3">
                    Ha megadod a <strong>pontos sz√ºlet√©si id≈ëd √©s helyed</strong>, akkor szem√©lyre szabott elemz√©st k√©sz√≠t√ºnk:
                  </p>
                  <ul class="text-amber-200/80 text-sm space-y-1 list-disc list-inside">
                    <li>Ascendens sz√°m√≠t√°s</li>
                    <li>Sz√ºlet√©si chart bolyg√≥kkal</li>
                    <li>H√°zrendszer elemz√©s</li>
                    <li>Aspektusok √©rtelmez√©se</li>
                    <li>Mai tranzitok hat√°sa r√°d</li>
                    <li>Pszichol√≥giai m√©lyelemz√©s</li>
                  </ul>
                </div>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderDetailedOptions() {
      return `
        <div class="bg-gradient-to-br from-slate-900/70 to-blue-950/60 backdrop-blur-2xl rounded-2xl p-8 border-2 bronze-glow" style="border-color: rgba(205, 127, 50, 0.6);">
          <h2 class="text-2xl font-semibold text-amber-200 mb-2 font-serif">R√©szletes Elemz√©s</h2>
          <p class="text-amber-300/80 mb-6">V√°laszd ki melyik ter√ºletet szeretn√©d m√©lyebben megismerni</p>
          
          <div class="mb-6">
            <label class="block text-amber-300/90 mb-3 font-medium">Elemz√©s t√≠pusa:</label>
            <select id="analysisType" class="w-full px-6 py-4 rounded-lg bg-slate-900/60 border-2 text-amber-100 text-lg focus:outline-none focus:ring-2 focus:ring-amber-500 cursor-pointer" style="border-color: rgba(205, 127, 50, 0.4);">
              <option value="">-- V√°lassz egy opci√≥t --</option>
              <option value="chart">ü™ê Sz√ºlet√©si Chart - Bolyg√≥k √©rtelmez√©se</option>
              <option value="houses">üè† H√°zrendszer - 12 √©letter√ºlet</option>
              <option value="aspects">üîó Aspektusok - Bolyg√≥k kapcsolatai</option>
              <option value="transits">üåô Mai Tranzitok - Aktu√°lis hat√°sok</option>
              <option value="personality">‚≠ê Szem√©lyis√©g M√©lyelemz√©s</option>
              <option value="full">üí´ Teljes Jelent√©s - Minden egy√ºtt</option>
            </select>
          </div>

          <div class="bg-slate-900/50 border rounded-lg p-4 mb-6" style="border-color: rgba(205, 127, 50, 0.3);">
            <div class="flex items-start gap-3">
              <div class="text-3xl">‚ÑπÔ∏è</div>
              <div>
                <h4 class="text-amber-300 font-semibold mb-1">Mit tartalmaz ez az elemz√©s?</h4>
                <p class="text-amber-200/80 text-sm" id="description">
                  V√°lassz egy opci√≥t a r√©szletes le√≠r√°shoz...
                </p>
              </div>
            </div>
          </div>

          <button 
            id="generateBtn"
            ${state.loading ? 'disabled' : ''}
            class="w-full py-4 rounded-xl font-bold text-lg transition-all shadow-2xl hover:shadow-amber-500/50 text-slate-900 disabled:opacity-50"
            style="background: linear-gradient(135deg, #cd7f32, #daa520, #ffd700, #daa520, #cd7f32);"
          >
            ${state.loading ? '‚è≥ Elemz√©s folyamatban...' : '‚ú® Elemz√©s Gener√°l√°sa'}
          </button>
        </div>
      `;
    }

    function renderAnalysisResult() {
      return `
        <div class="bg-gradient-to-br from-slate-900/70 to-blue-950/60 backdrop-blur-2xl rounded-2xl p-8 border-2 bronze-glow" style="border-color: rgba(205, 127, 50, 0.6);">
          <h2 class="text-2xl font-semibold text-amber-200 mb-4 font-serif">R√©szletes Elemz√©sed</h2>
          <div class="prose prose-invert max-w-none">
            <div class="text-amber-100/90 leading-relaxed whitespace-pre-wrap">${state.analysisResult}</div>
          </div>
        </div>
      `;
    }

    function attachEventListeners() {
      const form = document.getElementById('astroForm');
      if (form) {
        form.addEventListener('submit', handleSubmit);
      }

      const birthDate = document.getElementById('birthDate');
      const birthTime = document.getElementById('birthTime');
      const birthPlace = document.getElementById('birthPlace');

      if (birthDate) birthDate.addEventListener('input', (e) => state.birthDate = e.target.value);
      if (birthTime) birthTime.addEventListener('input', (e) => state.birthTime = e.target.value);
      if (birthPlace) birthPlace.addEventListener('input', (e) => state.birthPlace = e.target.value);

      const analysisType = document.getElementById('analysisType');
      if (analysisType) {
        analysisType.addEventListener('change', (e) => {
          state.selectedAnalysis = e.target.value;
          updateDescription(e.target.value);
        });
      }

      const generateBtn = document.getElementById('generateBtn');
      if (generateBtn) {
        generateBtn.addEventListener('click', generateAnalysis);
      }
    }

    function updateDescription(type) {
      const descriptions = {
        chart: "10 bolyg√≥ (Nap, Hold, Merk√∫r, V√©nusz, Mars, Jupiter, Szaturnusz, Ur√°nusz, Neptunusz, Pl√∫t√≥) r√©szletes pszichol√≥giai elemz√©se a szem√©lyis√©gedr≈ël, er≈ëss√©geidr≈ël √©s kih√≠v√°saidr√≥l.",
        houses: "A 12 √©letter√ºlet (karrier, szerelem, csal√°d, p√©nz, stb.) elemz√©se azt mutatja meg, hogy az √©leted mely ter√ºletein van k√ºl√∂nleges potenci√°lod vagy tanulnival√≥d.",
        aspects: "A bolyg√≥k k√∂z√∂tti sz√∂gkapcsolatok (konjunkci√≥, oppoz√≠ci√≥, trigon, n√©gyzet) meghat√°rozz√°k bels≈ë dinamik√°idat, tehets√©geidet √©s konfliktusaidat.",
        transits: "A mai bolyg√≥√°ll√°sok hat√°sa a sz√ºlet√©si chartodra - mi t√∂rt√©nik veled ma, milyen energi√°k hatnak r√°d, mire figyelj ma.",
        personality: "A Nap (k√ºls≈ë √©ned), Hold (bels≈ë √©ned) √©s Ascendens (ahogy m√°sok l√°tnak) h√°rmas√°nak m√©ly pszichol√≥giai elemz√©se - ez vagy te igaz√°n.",
        full: "Teljes k√∂r≈± asztrol√≥giai √©s pszichol√≥giai elemz√©s minden ter√ºletr≈ël - sz√ºlet√©si chart, h√°zak, aspektusok, tranzitok - egy √°tfog√≥ jelent√©sben."
      };

      const desc = descriptions[type];
      const descEl = document.getElementById('description');
      if (descEl) {
        descEl.textContent = desc || 'V√°lassz egy opci√≥t a r√©szletes le√≠r√°shoz...';
      }
    }

    window.closeWelcome = closeWelcome;

    render();
  </script>
</body>
</html>